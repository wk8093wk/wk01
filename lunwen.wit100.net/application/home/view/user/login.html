<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>密码登录</title>
        <meta name="keywords" content="{$config.seo_keyword}" />
		<meta name="description" content="{$config.seo_dec}" />
		<link rel="stylesheet" type="text/css" href="__HOMECSS__/list.css"/>
		<link rel="stylesheet" type="text/css" href="__HOMECSS__/common.css"/>
	</head>
	<body>
		<header class="on">
			<div class="header_center">

				<h1>
					<a href="/"><img src="__HOMEIMG__/biao.png"/></a>
				</h1>

			</div>
		</header>
		
		<div class="login">
			<div class="pic">
				<img src="__HOMEIMG__/login.png"/>
			</div>
			<div class="windowbox">
				<div class="tab">
					<a href="javascript:;" class="fl on">密码登录</a>
					<a href="javascript:;" class="fr">短信登录</a>
                    <input type="hidden" name="id" id="id" value="{$id}">
					<div class="clear"></div>
				</div>
				
				<div class="tab_content">
					<div class="tab_zi">
						<div class="item">
							<div class="name fl">
								<img src="__HOMEIMG__/shouji.png" />
							</div>
							<div class="infos fl">
								<input type="text" name="names" id="names" value="" class="text" placeholder="手机号/邮箱" />
							</div>
							<div class="clear"></div>
						</div>
						<div class="item">
							<div class="name fl">
								<img src="__HOMEIMG__/mima.png" />
							</div>
							<div class="infos fl">
								<input type="password" name="passwords" id="passwords" value="" class="text" placeholder="密码" />
							</div>
							<div class="clear"></div>
						</div>
						<input type="button" id="" name="" value="登录" class="btns" onClick="login()"/>
						<div class="abos">
							<a href="{:url('user/zhaohui')}" class="fl">忘记密码</a>
							<a href="/home/user/register.html?id={$id}" class="fr">注册</a>
							<div class="clear"></div>
						</div>
					</div>
					<div class="tab_zi" style="display:none;">
						<div class="item">
							<div class="name fl">
								<img src="__HOMEIMG__/shouji.png" />
							</div>
							<div class="infos fl">
								<input type="text" name="mobile" id="mobile" value="" class="text" placeholder="手机号/邮箱" />
							</div>
							<div class="clear"></div>
						</div>
						<div class="item">
							<div class="name fl">
								<img src="__HOMEIMG__/mima.png" />
							</div>
							<div class="infos fl">
								<input type="text" name="code" id="verification" value="" class="text2" placeholder="输入验证码" onBlur="code()" />
                                <input type="hidden" value="0" id="yzm" />
								<input type="button" id="" value="发送验证码" class="yan" onClick="send()" />
							</div>
							<div class="clear"></div>
						</div>
						<input type="button" id="" name="" value="登录" class="btns" onClick="duanxin()" />
						<div class="abos">
							<a href="{:url('user/zhaohui')}" class="fl">忘记密码</a>
							<a href="{:url('user/register')}" class="fr">注册</a>
							<div class="clear"></div>
						</div>
					</div>
				</div>
				
			</div>
			<div class="clear"></div>
		</div>
		
        	{include file="public/footeron" /}
        
		<script type="text/javascript" src="__HOMEJS__/jquery-1.9.1.min.js" ></script>
        <script src="__STATIC__/layuiadmin/layer/layer.js"></script>
        
		<script>
			$('.login .windowbox .tab a').eq(0).addClass('on');
			$('.tab_zi').not($('.tab_zi').eq(0).show()).hide();
			$('.login .windowbox .tab a').on('click',function(){
				$(this).addClass('on').siblings('a').removeClass('on');
				idx = $(this).index('.login .windowbox .tab a');
				$('.tab_zi').eq(idx).show().siblings().hide();
			})
		</script>
        <script>
        	var countdown = 60;
			var obj = $(".yan");
		
			function settime() { //发送验证码倒计时
				var mobile=$('#mobile').val();
				
				if(!(/^1[3456789]\d{9}$/.test(mobile))){ 
					layer.msg('手机号码有误，请重填！', {time: 1500});
					return false; 
				} 
				if(countdown == 0) {
					obj.val("获取验证码");
					obj.css('pointer-events', 'auto');
					countdown = 60;
					return;
				} else {
					obj.val("重新发送(" + countdown + ")s");
					countdown--;
		
					obj.css('pointer-events', 'none');
				}
		
				setTimeout(function() {
					settime();
				}, 1000)
			}
		
			$(".yan").click(function() {
				settime();
			})
        </script>
        <script>
        	function login(){
				
				var id=$('#id').val();
				var names=$('#names').val();
				var passwords=$('#passwords').val();
				
				if(names ==''){
					layer.msg('请输入手机号/邮箱！', {time: 1500});
					return false;
				}
				if(passwords == ''){
					layer.msg('请输入密码！', {time: 1500});
					return false;
				}
			
				
				$.ajax({
						url: "{:url('user/login_in')}",
						type:"POST",
						data:{names:names,passwords:passwords,id:id},
						//,sex:sex,mobile:mobile,
						dataType:"json",
						success: function(data){
							console.log(data);
							if(data.status==1){
								layer.msg('登录成功！', {time: 1500});
								window.location.href="{:url('index/index')}";
							}else if(data.status==3){
								layer.msg('登录成功！', {time: 1500});
								window.location.href="/home/meeting/meeting_detail.html?id="+id;
							}else{
								layer.msg('账号或密码错误！', {time: 1500});
							}
					   }
			 	});
				
			}
        
        </script>
        <script>
        	function duanxin(){
				
				var id=$('#id').val();
				var mobile=$('#mobile').val();
				var code=$('#code').val();
				var yzm=$('#yzm').val();
				
				if(mobile ==''){
					layer.msg('请输入手机号/邮箱！', {time: 1500});
					return false;
				}
				if(code == ''){
					layer.msg('请输入验证码！', {time: 1500});
					return false;
				}
				if(yzm == 0){
					layer.msg('验证码错误！', {time: 1500});
					return false;
				}
			
				
				$.ajax({
						url: "{:url('user/login_code')}",
						type:"POST",
						data:{mobile:mobile,id:id},
						//,sex:sex,mobile:mobile,
						dataType:"json",
						success: function(data){
							console.log(data);
							if(data.status==1){
								layer.msg('登录成功！', {time: 1500});
								window.location.href="{:url('index/index')}";
							}else if(data.status==3){
								layer.msg('登录成功！', {time: 1500});
								window.location.href="/home/meeting/meeting_detail.html?id="+id;
							}
					   }
			 	});
				
			}
        
        </script>
        <script>
        	function send(){
				var mobile=$('#mobile').val();
				if(mobile ==''){
					layer.msg('请输入手机号/邮箱！', {time: 1500});
					return false;
				}
				
				$.ajax({
						url: "{:url('user/sendlogin')}",
						type:"POST",
						data:{mobile:mobile},
						//,sex:sex,mobile:mobile,
						//dataType:"",
						success: function(data){
							var obj = eval('(' + data + ')');
							console.log(obj);
							if(obj.code==0){
								layer.msg(obj.msg, {time: 1500});
							}else if(obj.code==1){
								layer.msg(obj.msg, {time: 1500});
							}else{
								layer.msg(obj.msg, {time: 1500});
								return false;
							}
					   }
			 	});
			}
        </script>
        <script>
        	function code(){
				var verification=$('#verification').val();
				var mobile=$('#mobile').val();
				if(verification ==''){
					layer.msg('请输入验证码！', {time: 1500});
					return false;
				}
				
				$.ajax({
						url: "{:url('user/checkcode')}",
						type:"POST",
						data:{mobile:mobile,verification:verification},
						//,sex:sex,mobile:mobile,
						//dataType:"",
						success: function(data){
							console.log(data);
							var obj = eval('(' + data + ')');
							
							if(obj.code==0){
								layer.msg(obj.msg, {time: 1500});
								$('#yzm').val(1);
							}else{
								layer.msg(obj.msg, {time: 1500});
							}
					   }
			 	});
			}
        </script>
	</body>
</html>
