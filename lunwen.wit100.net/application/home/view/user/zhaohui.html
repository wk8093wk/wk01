<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>找回密码</title>
        <meta name="keywords" content="{$config.seo_keyword}" />
		<meta name="description" content="{$config.seo_dec}" />
		<link rel="stylesheet" type="text/css" href="__HOMECSS__/list.css"/>
		<link rel="stylesheet" type="text/css" href="__HOMECSS__/common.css"/>
	</head>
	<body>
		<header class="on">
			<div class="header_center">

				<h1>
					<a href="/"><img src="__HOMEIMG__/biao.png"/></a>
				</h1>

			</div>
		</header>
		
		<div class="login">
			<div class="pic">
				<img src="__HOMEIMG__/login.png"/>
			</div>
			<div class="windowbox">
				<h3>密码找回</h3>
				<div class="tab_content">
					<div class="tab_zi">
						<div class="item">
							<div class="infos">
								<input type="text" name="mobile" id="mobile" value="" class="text3" placeholder="手机号/邮箱" />
							</div>
							<div class="clear"></div>
						</div>
						<div class="item">
							<div class="infos">
								<input type="text" name="" id="" value="" class="text4" placeholder="输入验证码" onBlur="code()" />
                                <input type="hidden" id="yzm" value="0" />
								<input type="button" id="" value="发送验证码" class="yan" onClick="send()" />
							</div>
							<div class="clear"></div>
						</div>
                        <input type="button" class="btns mgb" onClick="find1()" value="下一步" placeholder="下一步" />
					</div>
				</div>
				
			</div>
			<div class="clear"></div>
		</div>
		
        	{include file="public/footeron" /}
        
		<script type="text/javascript" src="__HOMEJS__/jquery-1.9.1.min.js" ></script>
        <script src="__STATIC__/layuiadmin/layer/layer.js"></script>
		<script>
			var a = $('header').outerHeight(true);
			var b = $('footer').outerHeight(true);
			var d = $('.login').outerHeight(true);
			var c = $(window).height();
			$('.login').css('margin-top',(c-b-a-d)/2+'px');
		</script>
        <script>
        	var countdown = 60;
			var obj = $(".yan");
		
			function settime() { //发送验证码倒计时
				var mobile=$('#mobile').val();
				
				if(!(/^1[3456789]\d{9}$/.test(mobile))){ 
					layer.msg('手机号码有误，请重填！', {time: 1500});
					return false; 
				} 
				if(countdown == 0) {
					obj.val("获取验证码");
					obj.css('pointer-events', 'auto');
					countdown = 60;
					return;
				} else {
					obj.val("重新发送(" + countdown + ")s");
					countdown--;
		
					obj.css('pointer-events', 'none');
				}
		
				setTimeout(function() {
					settime();
				}, 1000)
			}
		
			$(".yan").click(function() {
				settime();
			})
        </script>
        <script>
        	function find1(){
				var yzm=$('#yzm').val();
				var mobile=$('#mobile').val();
				if(yzm ==0){
					layer.msg('验证码错误！', {time: 1500});
					return false;
				}
				window.location.href="{:url('user/zhaohui2')}?mobile="+mobile;
			}
        </script>
        <script>
        	function send(){
				var mobile=$('#mobile').val();
				if(mobile ==''){
					layer.msg('请输入手机号/邮箱！', {time: 1500});
					return false;
				}
				
				$.ajax({
						url: "{:url('user/findcode')}",
						type:"POST",
						data:{mobile:mobile},
						//,sex:sex,mobile:mobile,
						//dataType:"",
						success: function(data){
							var obj = eval('(' + data + ')');
							console.log(obj);
							if(obj.code==0){
								layer.msg(obj.msg, {time: 1500});
							}else if(obj.code==1){
								layer.msg(obj.msg, {time: 1500});
							}else{
								layer.msg(obj.msg, {time: 1500});
								return false;
							}
					   }
			 	});
			}
        </script>
        <script>
        	function code(){
				var verification=$('#verification').val();
				var mobile=$('#mobile').val();
				if(verification ==''){
					layer.msg('请输入验证码！', {time: 1500});
					return false;
				}
				
				$.ajax({
						url: "{:url('user/checkfindcode')}",
						type:"POST",
						data:{mobile:mobile,verification:verification},
						//,sex:sex,mobile:mobile,
						//dataType:"",
						success: function(data){
							console.log(data);
							var obj = eval('(' + data + ')');
							
							if(obj.code==0){
								layer.msg(obj.msg, {time: 1500});
								$('#yzm').val(1);
							}else{
								layer.msg(obj.msg, {time: 1500});
							}
					   }
			 	});
			}
        </script>
        
	</body>
</html>
